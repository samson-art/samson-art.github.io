############################################################################
#### C���������� .htaccess ��� �������� ������ ��������, ������ 2.4     ####
############################################################################
RewriteEngine On
   #  ��������� �������� ���������.
RewriteBase / 
   # ��� ��������� (.*) = /$1 ����� /var/wwww/site/web/$1  � ����������  = /$1
Options +FollowSymLinks
   # ��������� ������� �� ������������� �������.

############################################################################
#### �������������� �������� https �� http                              ####
############################################################################
RewriteCond %{SERVER_PORT} ^443$
   # ��������� ������� https � URL.
RewriteRule ^.*$ http://%{SERVER_NAME}%{REQUEST_URI}
   # �������������� �������� �� http.

############################################################################
#### ����� ��������� ������� (��� � www ��� ��� www)                    ####
############################################################################
   # 1. �������� � www �� ��� www. (���������������� ��������� ������ 1)
RewriteCond %{HTTP_HOST} ^www\.(.*) [NC]
   # ���������, �������� �� ����� www (� ������ URL).
RewriteRule ^(.*)$ http://%1/$1 [R=301,L]
   # �������������� URL �� ����� ��� www.
####
   # 2. �������� ��� www �� www. (���������������� ��������� ������ 2)
#RewriteCond %{HTTP_HOST} !^www\.(.*) [NC]
   # ���������, �� �������� �� ����� www (� ������ URL).
#RewriteRule ^(.*)$ http://www.%{HTTP_HOST}/$1 [R=301,L]
   # �������������� URL �� ����� c www.

############################################################################
#### ������� ������������� ����� (/) � URL                              ####
############################################################################
RewriteCond %{THE_REQUEST} //
   # ���������, ����������� �� ���� (//) ����� ���� ���.
RewriteRule .* /$0 [R=301,L]
   # ��������� ��� ������ �����.

############################################################################
#### ������� ����� � ����� URL ��� ����������� ������ (�������� �����)  ####
############################################################################
RewriteCond %{REQUEST_URI} \..+$  
   # ���� ���� �������� �����.
RewriteCond %{REQUEST_FILENAME} !-d   
   # � ��� �� ����������.
RewriteCond %{REQUEST_FILENAME} -f
   # �������� ������.
RewriteCond %{REQUEST_URI} ^(.+)/$      
   # � � ����� URL ���� ����.
RewriteRule ^(.+)/$ /$1 [R=301,L]     
   # ��������� ����.

############################################################################
#### ��������� ����(/), ���� ��� ���, � ��� �� ����.                    ####
############################################################################
RewriteCond %{REQUEST_URI} !(.*)/$
   # ���� ����� � ����� ���.
RewriteCond %{REQUEST_FILENAME} !-f
   # �� �������� ������.
RewriteCond %{REQUEST_URI} !\..+$
   # � URL ��� ����� (����).
RewriteRule ^(.*)$ $1/ [L,R=301]
   # ��������� ���� � �����.

############################################################################
#### ������� index.php, ���� �� ���� � ����� URL                        ####
############################################################################
RewriteCond %{REQUEST_METHOD} =GET
   # �������� GET ������ � URL (�� POST).
RewriteCond %{REQUEST_URI} ^(.*)/index\.php$
   # URL c������� index.php � �����.
RewriteRule ^(.*)$ %1/ [R=301,L]
   # ������� index.php �� URL.

############################################################################
#### ���������� ������������ �������� ��� ����  ���� ����               ####
############################################################################
<IfModule mod_deflate.c>
  # Compress HTML, CSS, JavaScript, Text, XML and fonts
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-otf
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>
<IfModule mod_expires.c>
  ExpiresActive on
  ExpiresByType image/jpeg "access plus 3 day"
  ExpiresByType image/svg "access plus 3 day"
  ExpiresByType image/gif "access plus 3 day"
  ExpiresByType image/png "access plus 3 day"
  ExpiresByType text/javascript "access plus 3 day"
  ExpiresByType text/css "access plus 3 day"
  ExpiresByType application/javascript "access plus 3 day"
</IfModule>
############################################################################
#### ����� ����� �����, ����� ������� ����������� ��������� .htaccess   ####
############################################################################

AddDefaultCharset UTF-8
DirectoryIndex index.html